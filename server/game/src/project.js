require=function e(t,n,i){function o(a,d){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!d&&c)return c(a,!0);if(r)return r(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var s=n[a]={exports:{}};t[a][0].call(s.exports,function(e){var n=t[a][1][e];return o(n?n:e)},s,s.exports,e,t,n,i)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<i.length;a++)o(i[a]);return o}({Controller:[function(e,t,n){"use strict";function i(e){return void 0!==window.URL?window.URL.createObjectURL(e):window.webkitURL.createObjectURL(e)}function o(e){c(i(e.target.files[0]))}function r(e){a(i(e.target.files[0]))}function a(e){var t=document.getElementById("tempDivReference");if(null===t){var t=document.createElement("div");document.body.appendChild(t),t.style.position="absolute",t.id="tempDivReference",t.innerHTML="<img id=imgheadReference>",t.style.display="none",t.style.visibility="hidden"}var n=document.getElementById("imgheadReference");n.onload=function(){var e=parseFloat(this.width),t=parseFloat(this.height);e>t?(e=224/t*e,t=224):(t=224/e*t,e=224);var n=parseFloat(this.width),i=parseFloat(this.height);n<i?(n=200/i*n,i=200):(i=200/n*i,n=200),s.node.width=parseInt(n),s.node.height=parseInt(i),C.width=parseInt(e),C.height=parseInt(t),C.getContext("2d").drawImage(this,0,0,C.width,C.height),x.getContext("2d").clearRect(0,0,x.width,x.height);var o=s.spriteFrame.getTexture(),r=u.getComponent("cc.Sprite").spriteFrame.getTexture();r.initWithElement(x),r.handleLoadedTexture(),o.initWithElement(C),o.handleLoadedTexture();var a=document.createElement("canvas");a.width=parseInt(n),a.height=parseInt(i),a.getContext("2d").drawImage(this,0,0,a.width,a.height),o._pixels=a.getContext("2d").getImageData(0,0,a.width,a.height).data,U=!0,M="new"},n.src=e}function d(e){var t=document.getElementById("tempDivResult");if(null===t){var t=document.createElement("div");document.body.appendChild(t),t.style.position="absolute",t.id="tempDivResult",t.innerHTML="<img id=imgheadResult>",t.style.display="none",t.style.visibility="hidden"}var n=document.getElementById("imgheadResult");n.onload=function(){var e=h.spriteFrame.getTexture();e.initWithElement(this),e.handleLoadedTexture();var t=parseFloat(this.width),n=parseFloat(this.height),i=!0;t>n?t>724&&(i=!1):n>724&&(i=!1),i||(t<n?(t=724/n*t,n=724):(n=724/t*n,t=724)),h.node.width=parseInt(t),h.node.height=parseInt(n),g.enabled=!0,m.string="<u>colorize</u>",P=I[0],M=I[1]},I=e.split("*"),2==I.length&&(W="results/"+I[0]+".jpg?t="+Math.random().toString(),n.src=W)}function c(e){var t=document.getElementById("tempDivSketch");if(null===t){var t=document.createElement("div");document.body.appendChild(t),t.style.position="absolute",t.id="tempDivSketch",t.innerHTML="<img id=imgheadSketch>",t.style.display="none",t.style.visibility="hidden"}var n=document.getElementById("imgheadSketch");n.onload=function(){var e=parseFloat(this.width),t=parseFloat(this.height);t<e?t>1024&&(e=1024/t*e,t=1024):e>1024&&(t=1024/e*t,e=1024),w.width=parseInt(e),w.height=parseInt(t),e>t?(e=512/t*e,t=512):(t=512/e*t,e=512),x.width=parseInt(e),x.height=parseInt(t),e=parseFloat(this.width),t=parseFloat(this.height),e<t?(e=512/t*e,t=512):(t=512/e*t,e=512),l.node.width=parseInt(e),l.node.height=parseInt(t),u.width=parseInt(e),u.height=parseInt(t),w.getContext("2d").drawImage(this,0,0,w.width,w.height),x.getContext("2d").clearRect(0,0,x.width,x.height);var n=u.getComponent("cc.Sprite").spriteFrame.getTexture();n.initWithElement(x),n.handleLoadedTexture();var i=l.spriteFrame.getTexture();i.initWithElement(w),i.handleLoadedTexture(),D=!0,P="new",M="new"},n.src=e}cc._RF.push(t,"806bcYbxcNFYKpTMgw+5/TX","Controller");var l,s,h,p,u,g,m,f,v,y,w,C,x,I,F=!1,T=!1,R=!1,b=!1,k=!1,L=!1,E=0,S=0,D=!1,U=!1,_=!0,N=!1,P="new",M="new",W="",B=2;cc.Texture2D.prototype._pixels=[],cc.Texture2D.prototype.getPixels=function(e,t,n,i){var o=parseInt((i-parseInt(t))*n*4+4*parseInt(e));return new cc.color(this._pixels[o],this._pixels[o+1],this._pixels[o+2])},cc.Class({"extends":cc.Component,properties:{sketchImg:{"default":null,type:cc.Node},referenceImg:{"default":null,type:cc.Node},resultImg:{"default":null,type:cc.Node},colorImg:{"default":null,type:cc.Node},flag:{"default":null,type:cc.Node},hint:{"default":null,type:cc.Node},btn:{"default":null,type:cc.Node},denoise:{"default":null,type:cc.Node},welcome:{"default":null,type:cc.Node}},onV1:function(){B=1,this.onClearClicked()},onV2:function(){B=2,this.onClearClicked()},onV3:function(){B=3,this.onClearClicked()},onV4:function(){B=4,this.onClearClicked()},onLoad:function(){cc.director.setClearColor(cc.color(0,0,0,0)),l=this.sketchImg.getComponent("cc.Sprite"),s=this.referenceImg.getComponent("cc.Sprite"),h=this.resultImg.getComponent("cc.Sprite"),p=this.colorImg.getComponent("cc.Sprite"),u=this.hint,g=this.btn.getComponent("cc.Button"),m=this.btn.getComponent("cc.RichText"),f=document.createElement("input"),f.id="fileInputForSketch",f.type="file",f.accept="image/*",f.style.height="0px",f.style.display="block",f.style.overflow="hidden",document.body.insertBefore(f,document.body.firstChild),f.addEventListener("change",o,!1),v=document.createElement("input"),v.id="fileInputForReferene",v.type="file",v.accept="image/*",v.style.height="0px",v.style.display="block",v.style.overflow="hidden",document.body.insertBefore(v,document.body.firstChild),v.addEventListener("change",r,!1),this.node.on("mousemove",function(e){y=e.getLocation()}),this.node.on("mousedown",function(e){N=!0}),this.node.on("mouseup",function(e){R=!0,N=!1}),x=document.createElement("canvas"),x.id="HTML_Canvas_hint",C=document.createElement("canvas"),C.id="HTML_Canvas_reference",w=document.createElement("canvas"),w.id="HTML_Canvas_sketch",T=!0},onSketchClicked:function(){f.click()},onRefenceClicked:function(){v.click()},onPenClicked:function(){_=!0},onEraserClicked:function(){_=!1},onClearClicked:function(){var e=x.getContext("2d");e.clearRect(0,0,x.width,x.height);var t=u.getComponent("cc.Sprite").spriteFrame.getTexture();t.initWithElement(x),t.handleLoadedTexture()},onColorizeClicked:function(){if(U&&D){h.node.width=0,h.node.height=0;var e=x.toDataURL("image/png"),t=C.toDataURL("image/png"),n=w.toDataURL("image/png"),i=new XMLHttpRequest;i.open("POST","/paint",!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded;"),i.onreadystatechange=function(){d(i.responseText)},"new"!=P&&(n="null"),"new"!=M&&(t="null"),i.send("sketch="+encodeURIComponent(n)+"&reference="+encodeURIComponent(t)+"&hint="+encodeURIComponent(e)+"&version="+B.toString()+"&denoise="+this.denoise.getComponent("cc.Toggle").isChecked.toString()+"&sketchID="+P+"&referenceID="+M),g.enabled=!1,m.string="Waiting",this.welcome.active=!1}},onDownloadClicked:function(){""!=W&&window.open(W)},handlePainter:function(){L=!1;var e=0,t=0,n=l.node.convertToWorldSpace(l.node.position);if(null!=n&&null!=y){var i=n.x-256,o=n.y-256;e=y.x-i,t=y.y-o;var r=e>0&&t>0&&e<l.node.width&&t<l.node.height;r&&(L=!0)}if(L&&N){var a=x.getContext("2d");if(_){var d=6-B;a.beginPath(),a.arc(parseInt(parseFloat(e)/parseFloat(u.width)*parseFloat(x.width)),parseInt(parseFloat(u.height-t)/parseFloat(u.height)*parseFloat(x.height)),d,0,2*Math.PI,!0),a.closePath();var c=p.node.color;a.fillStyle="rgba("+c.r.toString()+","+c.g.toString()+","+c.b.toString()+",0.618)",a.fill()}else{var a=x.getContext("2d");a.clearRect(parseInt(parseFloat(e)/parseFloat(u.width)*parseFloat(x.width))-10,parseInt(parseFloat(u.height-t)/parseFloat(u.height)*parseFloat(x.height))-10,20,20)}var s=u.getComponent("cc.Sprite").spriteFrame.getTexture();s.initWithElement(x),s.handleLoadedTexture(!0)}},handleColorPicker:function(){var e=s.node.convertToWorldSpace(s.node.position);if(null!=e&&null!=y){var t=e.x,n=e.y,i=y.x-t,o=y.y-n;if(F=i>0&&o>0&&i<s.node.width&&o<s.node.height)b||(k=!0),R&&k&&(this.flag.x=i-s.node.width/2,this.flag.y=o-s.node.height/2,E=i,S=o,_=!0);else if(k){k=!1;s.spriteFrame.getTexture();p.node.color=s.spriteFrame.getTexture().getPixels(E,S,s.node.width,s.node.height)}if(k){s.spriteFrame.getTexture();p.node.color=s.spriteFrame.getTexture().getPixels(i,o,s.node.width,s.node.height)}}},update:function(e){T&&(this.handleColorPicker(),this.handlePainter(),k?document.body.style.cursor="crosshair":L?document.body.style.cursor="crosshair":document.body.style.cursor="default"),b=F,R=!1}}),cc._RF.pop()},{}],openURL:[function(e,t,n){"use strict";cc._RF.push(t,"c3edbKDNW5IabfV9hr8BIUy","openURL"),cc.Class({"extends":cc.Component,properties:{url:{"default":"",type:String}},onOpen:function(){window.open(this.url)}}),cc._RF.pop()},{}]},{},["Controller","openURL"]);